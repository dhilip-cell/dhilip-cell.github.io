<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SFX Assistant Widget</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    /* Floating button */
    #chatToggle {
      position: fixed;
      bottom: 20px; right: 20px;
      width: 60px; height: 60px;
      border-radius: 50%; border: none;
      background: #33B04A; color: #fff;
      font-size: 24px; cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,.25);
      z-index: 9999;
    }
    /* Chat box */
    #chatWidget {
      position: fixed;
      bottom: 90px; right: 20px;
      width: 320px; max-height: 480px;
      background: #fff; border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,.25);
      display: none; flex-direction: column;
      overflow: hidden; z-index: 9999;
    }
    #chatHeader {
      background: #0D333F; color: #fff;
      padding: 12px; font-weight: bold;
    }
    #chatMessages {
      flex: 1; padding: 10px; overflow-y: auto;
      font-size: 14px;
    }
    .msg { margin: 6px 0; padding: 8px 10px; border-radius: 8px; max-width: 80%; }
    .user { background: #33B04A; color:#fff; margin-left:auto; }
    .bot  { background: #eee; color:#000; margin-right:auto; }
    .sys  { background:#fff6e5; border:1px dashed #f2cf73; color:#6b4e00; margin:4px auto; }
    #chatInputArea {
      display: flex; border-top: 1px solid #ddd;
    }
    #chatInput {
      flex: 1; border: none; padding: 10px;
      font-size: 14px;
    }
    #chatSend {
      background:#33B04A; color:#fff;
      border:none; padding:0 16px; cursor:pointer;
    }
  </style>
</head>
<body>

<button id="chatToggle">💬</button>

<div id="chatWidget">
  <div id="chatHeader">SFX Assistant</div>
  <div id="chatMessages"></div>
  <div id="chatInputArea">
    <input id="chatInput" type="text" placeholder="Type a message..." onkeydown="if(event.key==='Enter') sendMessage()">
    <button id="chatSend" onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
  // -------- CONFIG ----------
  const CONFIG = {
    WEBHOOK_URL: "https://automations-salesflowx.app.n8n.cloud/webhook-test/sfxagent",
    SESSION_ID: "sfx-static-session-id"
  };

  const toggleBtn = document.getElementById("chatToggle");
  const widget = document.getElementById("chatWidget");

  toggleBtn.onclick = () => {
    widget.style.display = widget.style.display === "flex" ? "none" : "flex";
    widget.style.flexDirection = "column";
  };

  function addMsg(text, sender){
    const msg = document.createElement("div");
    msg.className = "msg " + sender;
    msg.textContent = text;
    document.getElementById("chatMessages").appendChild(msg);
    msg.scrollIntoView({behavior:"smooth"});
  }

  async function sendMessage(){
    const input = document.getElementById("chatInput");
    const text = input.value.trim();
    if(!text) return;
    addMsg(text,"user");
    input.value = "";

    try {
      const payload = { chat_input: text, session_id: CONFIG.SESSION_ID };
      const res = await fetch(CONFIG.WEBHOOK_URL,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });

      let reply = "⚠️ No response from server";
      if(res.ok){
        try {
          const data = await res.json();
          reply = data?.[0]?.output || data?.output || JSON.stringify(data);
        } catch(e){}
      } else {
        reply = `⚠️ Server ${res.status} ${res.statusText}`;
      }
      addMsg(reply,"bot");
    } catch(e){
      addMsg("⚠️ Error contacting server","sys");
    }
  }

  // Greeting
  window.onload = () => addMsg("Hello 👋 I'm your SalesflowX Assistant!","bot");
</script>

</body>
</html>
